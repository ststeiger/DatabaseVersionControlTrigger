
-- https://ourworldindata.org/grapher/economic-inequality-gini-index?tab=chart&time=earliest..2021&country=USA~FRA~CHE~AUT~DEU~ITA~SWE~TWN~NOR
-- https://stackoverflow.com/questions/1342898/function-to-calculate-median-in-sql-server

CREATE ASSEMBLY CustomAggregate FROM '{path to your DLL}'
WITH PERMISSION_SET=SAFE;
GO

CREATE AGGREGATE Median( @value decimal(9, 3) )
RETURNS decimal(9, 3) 
EXTERNAL NAME [CustomAggregate].[{namespace of your DLL}.Median];
GO





CREATE ASSEMBLY ExampleClrAggregate 
-- FROM N'D:\username\Documents\Visual Studio 2022\github\DatabaseVersionControlTrigger\ExampleClrAggregate\bin\Debug\ExampleClrAggregate.dll' 
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103003A1C3BF70000000000000000E00022200B0130000010000000060000000000003A2F0000002000000040000000000010002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000E62E00004F00000000400000C803000000000000000000000000000000000000006000000C0000000C2E0000380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000400F0000002000000010000000020000000000000000000000000000200000602E72737263000000C8030000004000000004000000120000000000000000000000000000400000402E72656C6F6300000C00000000600000000200000016000000000000000000000000000040000042000000000000000000000000000000001A2F000000000000480000000200050028230000E40A00000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000360002731000000A7D010000042A0000133002002300000001000011000F01281100000A16FE010A062C13027B010000040F01281200000A6F1300000A002A0013300200210000000100001100037B0100000414FE030A062C12027B01000004037B010000046F1400000A002A00000013300400AF0000000200001100027B010000046F1500000A16FE030A06398A00000000027B010000046F1600000A00027B010000046F1500000A185D16FE010C082C45027B01000004027B010000046F1500000A185B17596F1700000A027B01000004027B010000046F1500000A185B6F1700000A281800000A18731900000A281A00000A0B2B1B027B01000004027B010000046F1500000A1759185B6F1700000A0B07731B00000A0D2B0D1204FE151600000111040D2B00092A0013300500570000000300001100036F1C00000A0A02731000000A7D010000040006178D1B00000125161F2C9D6F1D00000A0B160C2B2607089A0D00091204281E00000A130511052C0E027B0100000411046F1300000A00000817580C08078E6932D42A00133003006B0000000400001100731F00000A0A160B2B35000716FE020C082C0C0672010000706F2000000A2606027B01000004076F1700000A0D1203282100000A6F2000000A26000717580B07027B010000046F1500000AFE04130411042DB703066F2200000A6F2300000A00066F2400000A26140A2A2202282500000A002A133005004C000000050000110020000100008D1D0000010A160B2B280012017205000070282600000A0C060708166F2700000A08176F2700000A1F1062589E000717580B072000010000FE040D092DCC0613042B0011042A133004004E00000006000011007E020000040A028E69185A8D1B0000010B160C2B1F0006020891950D0718085A09D19D0718085A1758091F1064D19D000817580C08028E69FE04130411042DD507732800000A13052B0011052A2202282500000A002A2E280800000680020000042A0042534A4201000100000000000C00000076342E302E33303331390000000005006C00000094030000237E0000000400006C04000023537472696E6773000000006C0800000C0000002355530078080000100000002347554944000000880800005C02000023426C6F620000000000000002000001571702080900000000FA013300160000010000001E00000003000000020000000B0000000500000001000000280000000F000000060000000100000001000000020000000000B0020100000000000600CB01C90306003802C9030600DE0097030F00E903000006000601F6020600AE01F60206008F01F60206001F02F6020600EB01F60206000402F60206003E01F6020600F200AA030600D000AA0306007201F6020600590177020A0024046F030A001D016F0306002B04DC020A0066026F0306000F005E000600A802DC020A00A502F80306001F033F00060062033F0006002C034C04060001005E0006001A03DC0206009E02DC0206002F00DC0206003000DC02000000003600000000000100010001201000E302A1004900010001000000100052033A0349000200080001001304C90031002500D10050200000000086003804060001006020000000008600B500D500010090200000000086009200DB000200C020000000008600C000E10003007C2100000000E6017900E6000300E02100000000E601CA00EC00040057220000000086188A030600050060220000000091001600F2000500B8220000000093005A04F700050012230000000086188A03060006001B230000000091189003FD000600000001006002000001004C03000001009503000001005804000001000D0402004D0009008A03010011008A03060019008A030A0029008A03100031008A03100039008A03100041008A03100049008A03100051008A03100059008A03100061008A03150069008A03100071008A03100079008A03100089008A031A000C008A030600B100C8022B00B10056022F000C007E0034000C0089003A000C003D044F000C00470406000C00D3025300A90008035900A9008A030100A900EA025900B1008A036200B90091027300E10032047700A90098007E00C9008A030600C90082009000A9009C02730091009C027300C100CA001000C9001403960091008A030600F1009C02A500E1001A04AA00E1008A03BA002E000B0001012E0013000A012E001B0029012E00230032012E002B004B012E0033004B012E003B004B012E00430032012E004B0051012E0053004B012E005B004B012E00630069012E006B0093012E007300A00143007B00E80127004400680086009B00AF002000048000000100000000000000000000000000A1000000040000000000000000000000C000550000000000040000000000000000000000C00049000000000000000049456E756D657261626C656031004C6973746031004372656174654C6F6F6B75703332005F6C6F6F6B757033320055496E743332003C4D6F64756C653E0053797374656D2E494F0053797374656D2E44617461006D73636F726C69620053797374656D2E436F6C6C656374696F6E732E47656E6572696300526561640041646400417070656E640041646452616E6765004D65726765005472795061727365004578616D706C65436C7241676772656761746500416363756D756C617465005465726D696E61746500577269746500477569644174747269627574650044656275676761626C6541747472696275746500436F6D56697369626C6541747472696275746500417373656D626C795469746C654174747269627574650053716C55736572446566696E656441676772656761746541747472696275746500417373656D626C7954726164656D61726B417474726962757465005461726765744672616D65776F726B41747472696275746500417373656D626C7946696C6556657273696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C794465736372697074696F6E41747472696275746500436F6D70696C6174696F6E52656C61786174696F6E7341747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C79436F6D70616E794174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465006765745F56616C75650076616C7565004942696E61727953657269616C697A650053797374656D2E52756E74696D652E56657273696F6E696E670052656164537472696E6700546F537472696E670053716C446563696D616C004578616D706C65436C724167677265676174652E646C6C006765745F49734E756C6C006765745F4974656D0053797374656D004D656469616E006F705F4469766973696F6E0053797374656D2E5265666C656374696F6E006F705F4164646974696F6E00436C65617200436861720042696E61727952656164657200537472696E674275696C646572004578616D706C65436C7254726967676572006F746865720042797465417272617948656C7065720042696E617279577269746572004D6963726F736F66742E53716C5365727665722E536572766572002E63746F72002E6363746F720053797374656D2E446961676E6F73746963730053797374656D2E52756E74696D652E496E7465726F7053657276696365730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F6465730053797374656D2E446174612E53716C5479706573006279746573005F6974656D73006765745F436861727300466F726D6174004F626A6563740053706C697400496E6974006765745F436F756E7400536F72740053797374656D2E54657874007700427974654172726179546F4865780000000000032C0000055800320000001253DC53B3A6D344A69CDFFCEBDA7A3200042001010803200001052001011111042001010E04200101020520010111410615125101115503070102032000020420001155052001011300092001011512690113000A07050211550211591159032000080520011300080800021155115511550520010111550A07060E1D0E080E1155020320000E0620011D0E1D03070002020E1011550907051265080211550205200112650E04200012650907051D09080E021D090420010E0E04200103080A07061D091D030809020E052001011D0308B77A5C561934E089070615125101115503061D09052001011159052001011208042000115905200101125D0520010112610400001D090500010E1D05030000010801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F777301080100070100000000180100134578616D706C65436C72416767726567617465000005010000000017010012436F7079726967687420C2A920203230323400002901002430376366393033662D666162392D346363372D616238632D39333930356232336136643100000C010007312E302E302E3000004701001A2E4E45544672616D65776F726B2C56657273696F6E3D76342E300100540E144672616D65776F726B446973706C61794E616D65102E4E4554204672616D65776F726B20347201000200000005005402124973496E76617269616E74546F4E756C6C73015402174973496E76617269616E74546F4475706C696361746573005402124973496E76617269616E74546F4F726465720154080B4D61784279746553697A65FFFFFFFF54020D49734E756C6C4966456D707479010000000000CEF7DED50000000002000000A2000000442E00004410000000000000000000000000000010000000000000000000000000000000525344537FB08FF56798A0489892B021F2002BBD01000000443A5C73746566616E2E737465696765725C446F63756D656E74735C56697375616C2053747564696F20323032325C6769746875625C446174616261736556657273696F6E436F6E74726F6C547269676765725C4578616D706C65436C724167677265676174655C6F626A5C44656275675C4578616D706C65436C724167677265676174652E706462000E2F00000000000000000000282F00000020000000000000000000000000000000000000000000001A2F0000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C00000000000000FF2500200010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000006C03000000000000000000006C0334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000001000000000000000100000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004CC020000010053007400720069006E006700460069006C00650049006E0066006F000000A802000001003000300030003000300034006200300000001A000100010043006F006D006D0065006E007400730000000000000022000100010043006F006D00700061006E0079004E0061006D0065000000000000000000500014000100460069006C0065004400650073006300720069007000740069006F006E00000000004500780061006D0070006C00650043006C0072004100670067007200650067006100740065000000300008000100460069006C006500560065007200730069006F006E000000000031002E0030002E0030002E003000000050001800010049006E007400650072006E0061006C004E0061006D00650000004500780061006D0070006C00650043006C0072004100670067007200650067006100740065002E0064006C006C0000004800120001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020002000320030003200340000002A00010001004C006500670061006C00540072006100640065006D00610072006B00730000000000000000005800180001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000004500780061006D0070006C00650043006C0072004100670067007200650067006100740065002E0064006C006C000000480014000100500072006F0064007500630074004E0061006D006500000000004500780061006D0070006C00650043006C0072004100670067007200650067006100740065000000340008000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0030002E0030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C0000003C3F00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 
-- WITH PERMISSION_SET = SAFE 
-- WITH PERMISSION_SET = EXTERNAL_ACCESS 
WITH PERMISSION_SET = UNSAFE 
; 


CREATE AGGREGATE Median( @value decimal(9, 3) )
RETURNS decimal(9, 3) 
EXTERNAL NAME [CustomAggregate].[ExampleClrAggregate.Median];
GO



CREATE AGGREGATE dbo.Median( @value decimal(9, 3) )
RETURNS decimal(9, 3) 
EXTERNAL NAME [ExampleClrAggregate].[ExampleClrAggregate.Median];
GO

